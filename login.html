<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login ‚Äî EduFace</title>
    <link rel="stylesheet" href="css/global.css">
    <style>
        .login-page {
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 2rem;
        }

        .login-card {
            width: 100%;
            max-width: 440px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 3rem 2.5rem;
            position: relative;
            z-index: 1;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header .logo-big {
            width: 64px;
            height: 64px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: grid;
            place-items: center;
            font-size: 2rem;
            margin: 0 auto 1rem;
            box-shadow: var(--shadow-glow);
        }

        .login-header h1 {
            font-size: 1.6rem;
        }

        .login-header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.3rem;
        }

        .divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
        }

        .login-footer {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-muted);
            font-size: 0.88rem;
        }

        .login-footer a {
            color: var(--accent-purple-light);
            font-weight: 600;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        /* Face login section */
        .face-login-section {
            text-align: center;
            margin-top: 1rem;
        }

        .face-login-preview {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 3px solid var(--border-color);
            margin: 1rem auto;
            overflow: hidden;
            background: var(--bg-secondary);
            display: grid;
            place-items: center;
        }

        .face-login-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .face-login-preview .placeholder-icon {
            font-size: 3rem;
            color: var(--text-muted);
        }

        .scan-ring {
            animation: scanPulse 2s ease-in-out infinite;
            border-color: var(--accent-purple) !important;
        }

        @keyframes scanPulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.3);
            }

            50% {
                box-shadow: 0 0 0 15px rgba(139, 92, 246, 0);
            }
        }
    </style>
</head>

<body>
    <div id="nav"></div>
    <div class="bg-glow glow-1"></div>
    <div class="bg-glow glow-2"></div>

    <div class="login-page">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-big">üéì</div>
                <h1>Welcome Back</h1>
                <p>Login to your student portal</p>
            </div>

            <!-- Email Login -->
            <form id="loginForm" onsubmit="handleEmailLogin(event)">
                <div class="form-group">
                    <label>Email or Roll Number</label>
                    <input type="text" class="form-input" id="loginEmail"
                        placeholder="e.g. deepak@student.edu or CS2022001" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password"
                        required>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Login ‚Üí</button>
            </form>

            <div class="divider">or</div>

            <!-- Face Login -->
            <div class="face-login-section">
                <button class="btn btn-secondary" style="width:100%" onclick="startFaceLogin()" id="faceLoginBtn">
                    üì∏ Login with Face Recognition
                </button>
                <div id="faceLoginArea" style="display:none; margin-top:1rem;">
                    <div class="face-login-preview" id="facePreview">
                        <video id="loginVideo" autoplay playsinline></video>
                    </div>
                    <p style="color:var(--text-muted); font-size:0.8rem; margin-top:0.5rem;">Look at the camera to
                        verify</p>
                    <button class="btn btn-primary mt-2" onclick="captureFaceLogin()">Verify Face</button>
                    <button class="btn btn-outline mt-1" onclick="stopFaceLogin()"
                        style="font-size:0.85rem;">Cancel</button>
                </div>
            </div>

            <div class="login-footer">
                Don't have an account? <a href="register.html">Register here</a>
                <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border-color);">
                    <a href="admin.html" style="color:var(--text-muted); font-size:0.8rem;">üîê Admin Login</a>
                </div>
            </div>
        </div>
    </div>

    <div id="footer"></div>

    <script src="js/app.js"></script>
    <script>
        document.getElementById('nav').innerHTML = renderNavbar('login');
        document.getElementById('footer').innerHTML = renderFooter();

        let loginStream = null;

        function handleEmailLogin(e) {
            e.preventDefault();
            const input = document.getElementById('loginEmail').value.trim();
            const students = DB.get('students');
            const user = students.find(s => s.email === input || s.rollNo === input);
            if (user) {
                setCurrentUser(user);
                showToast(`Welcome back, ${user.name}!`, 'success');
                setTimeout(() => window.location.href = 'dashboard.html', 800);
            } else {
                showToast('Student not found. Please register first.', 'error');
            }
        }

        function startFaceLogin() {
            document.getElementById('faceLoginArea').style.display = 'block';
            document.getElementById('faceLoginBtn').style.display = 'none';
            const video = document.getElementById('loginVideo');
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    loginStream = stream;
                    video.srcObject = stream;
                    document.getElementById('facePreview').classList.add('scan-ring');
                })
                .catch(() => showToast('Could not access camera', 'error'));
        }

        function captureFaceLogin() {
            // Demo: just log in as the first user with face data
            const students = DB.get('students');
            if (students.length > 0) {
                setCurrentUser(students[0]);
                showToast(`Face verified! Welcome, ${students[0].name}`, 'success');
                stopFaceLogin();
                setTimeout(() => window.location.href = 'dashboard.html', 1000);
            } else {
                showToast('No registered faces found', 'error');
            }
        }

        function stopFaceLogin() {
            if (loginStream) { loginStream.getTracks().forEach(t => t.stop()); loginStream = null; }
            document.getElementById('faceLoginArea').style.display = 'none';
            document.getElementById('faceLoginBtn').style.display = 'block';
            document.getElementById('facePreview').classList.remove('scan-ring');
        }
    </script>
</body>

</html>